// manifest.json
{
  "manifest_version": 3,
  "name": "אינדקס רץ לדיבים",
  "version": "1.0",
  "description": "מוסיף אינדקס רץ לדיבים עם קלאס bbb בתוך דיב עם קלאס aaa",
  "permissions": ["scripting"],
  "host_permissions": ["https://example.com/*"],
  "content_scripts": [
    {
      "matches": ["https://example.com/*"],
      "js": ["content.js"],
      "css": ["styles.css"]
    }
  ]
}

// content.js
(function() {
  // פונקציה להוספת אינדקסים
  function addIndexesToBbbDivs() {
    // מוצא את כל הדיבים עם קלאס aaa
    const aaaDivs = document.querySelectorAll('.aaa');
    
    // עובר על כל דיב aaa
    aaaDivs.forEach(function(aaaDiv) {
      // מוצא את כל הדיבים עם קלאס bbb בתוך דיב aaa הנוכחי
      const bbbDivs = aaaDiv.querySelectorAll('.bbb');
      
      // מוסיף אינדקס לכל דיב bbb
      bbbDivs.forEach(function(bbbDiv, index) {
        // בודק אם כבר הוספנו אינדקס לדיב זה
        if (!bbbDiv.querySelector('.index-circle')) {
          // יוצר אלמנט חדש לאינדקס
          const indexElement = document.createElement('div');
          indexElement.className = 'index-circle';
          indexElement.textContent = index + 1; // אינדקס מתחיל מ-1
          
          // מוסיף את האינדקס לתחילת הדיב
          bbbDiv.insertBefore(indexElement, bbbDiv.firstChild);
        }
      });
    });
  }

  // פונקציה שתפעל כאשר יש שינויים בדום
  function observeDOMChanges() {
    // יצירת אובזרבר שיעקוב אחרי שינויים בדום
    const observer = new MutationObserver(function(mutations) {
      addIndexesToBbbDivs();
    });
    
    // מתחיל לעקוב אחרי שינויים בדום
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  }

  // הפעלה ראשונית של הוספת האינדקסים
  addIndexesToBbbDivs();
  
  // מפעיל את המעקב אחרי שינויים בדום
  observeDOMChanges();
})();

// styles.css
.index-circle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: #3498db;
  color: white;
  font-weight: bold;
  font-size: 14px;
  margin-right: 8px;
  position: absolute;
  right: auto;
  left: 10px;
  top: 10px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: background-color 0.3s ease;
}

.index-circle:hover {
  background-color: #2980b9;
}

/* מוודא שלדיב שמכיל את האינדקס יש מיקום יחסי */
.bbb {
  position: relative;
  padding-left: 40px; /* מוסיף מרווח משמאל עבור האינדקס */
}
